[2025-02-21T13:37:14.535+0000] {taskinstance.py:1159} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: kafka_spark_dag.pyspark_consumer scheduled__2025-02-20T13:36:18.563861+00:00 [queued]>
[2025-02-21T13:37:14.567+0000] {taskinstance.py:1159} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: kafka_spark_dag.pyspark_consumer scheduled__2025-02-20T13:36:18.563861+00:00 [queued]>
[2025-02-21T13:37:14.568+0000] {taskinstance.py:1361} INFO - Starting attempt 1 of 2
[2025-02-21T13:37:14.613+0000] {taskinstance.py:1382} INFO - Executing <Task(DockerOperator): pyspark_consumer> on 2025-02-20 13:36:18.563861+00:00
[2025-02-21T13:37:14.635+0000] {standard_task_runner.py:57} INFO - Started process 717 to run task
[2025-02-21T13:37:14.646+0000] {standard_task_runner.py:84} INFO - Running: ['airflow', 'tasks', 'run', 'kafka_spark_dag', 'pyspark_consumer', 'scheduled__2025-02-20T13:36:18.563861+00:00', '--job-id', '34', '--raw', '--subdir', 'DAGS_FOLDER/dag_kafka_spark.py', '--cfg-path', '/tmp/tmpkpxt9ztp']
[2025-02-21T13:37:14.649+0000] {standard_task_runner.py:85} INFO - Job 34: Subtask pyspark_consumer
[2025-02-21T13:37:14.809+0000] {task_command.py:416} INFO - Running <TaskInstance: kafka_spark_dag.pyspark_consumer scheduled__2025-02-20T13:36:18.563861+00:00 [running]> on host d5862e138d8d
[2025-02-21T13:37:15.009+0000] {taskinstance.py:1662} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='airflow' AIRFLOW_CTX_DAG_ID='kafka_spark_dag' AIRFLOW_CTX_TASK_ID='pyspark_consumer' AIRFLOW_CTX_EXECUTION_DATE='2025-02-20T13:36:18.563861+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2025-02-20T13:36:18.563861+00:00'
[2025-02-21T13:37:15.187+0000] {docker.py:343} INFO - Starting docker container from image rappel-conso/spark:latest
[2025-02-21T13:37:17.719+0000] {docker.py:413} INFO - [38;5;6mspark [38;5;5m13:37:17.70 [0m[38;5;2mINFO [0m ==>
[2025-02-21T13:37:17.742+0000] {docker.py:413} INFO - [38;5;6mspark [38;5;5m13:37:17.73 [0m[38;5;2mINFO [0m ==> [1mWelcome to the Bitnami spark container[0m
[2025-02-21T13:37:17.756+0000] {docker.py:413} INFO - [38;5;6mspark [38;5;5m13:37:17.75 [0m[38;5;2mINFO [0m ==> Subscribe to project updates by watching [1mhttps://github.com/bitnami/containers[0m
[2025-02-21T13:37:17.769+0000] {docker.py:413} INFO - [38;5;6mspark [38;5;5m13:37:17.76 [0m[38;5;2mINFO [0m ==> Did you know there are enterprise versions of the Bitnami catalog? For enhanced secure software supply chain features, unlimited pulls from Docker, LTS support, or application customization, see Bitnami Premium or Tanzu Application Catalog. See https://www.arrow.com/globalecs/na/vendors/bitnami/ for more information.
[2025-02-21T13:37:17.780+0000] {docker.py:413} INFO - [38;5;6mspark [38;5;5m13:37:17.77 [0m[38;5;2mINFO [0m ==>
[2025-02-21T13:37:17.884+0000] {docker.py:413} INFO - 
[2025-02-21T13:37:52.408+0000] {docker.py:413} INFO - :: loading settings :: url = jar:file:/opt/bitnami/spark/jars/ivy-2.5.1.jar!/org/apache/ivy/core/settings/ivysettings.xml
[2025-02-21T13:37:52.818+0000] {docker.py:413} INFO - Ivy Default Cache set to: /opt/bitnami/spark/.ivy2/cache
[2025-02-21T13:37:52.823+0000] {docker.py:413} INFO - The jars for the packages stored in: /opt/bitnami/spark/.ivy2/jars
[2025-02-21T13:37:52.882+0000] {docker.py:413} INFO - org.postgresql#postgresql added as a dependency
[2025-02-21T13:37:52.884+0000] {docker.py:413} INFO - org.apache.spark#spark-sql-kafka-0-10_2.12 added as a dependency
[2025-02-21T13:37:52.888+0000] {docker.py:413} INFO - :: resolving dependencies :: org.apache.spark#spark-submit-parent-d706cd6e-0aec-4883-8377-41724e3539c2;1.0
	confs: [default]
[2025-02-21T13:37:56.209+0000] {docker.py:413} INFO - found org.postgresql#postgresql;42.5.4 in central
[2025-02-21T13:37:56.631+0000] {docker.py:413} INFO - found org.checkerframework#checker-qual;3.5.0 in central
[2025-02-21T13:38:00.955+0000] {docker.py:413} INFO - found org.apache.spark#spark-sql-kafka-0-10_2.12;3.5.0 in central
[2025-02-21T13:38:02.650+0000] {docker.py:413} INFO - found org.apache.spark#spark-token-provider-kafka-0-10_2.12;3.5.0 in central
[2025-02-21T13:38:02.984+0000] {docker.py:413} INFO - found org.apache.kafka#kafka-clients;3.4.1 in central
[2025-02-21T13:38:03.229+0000] {docker.py:413} INFO - found org.lz4#lz4-java;1.8.0 in central
[2025-02-21T13:38:03.398+0000] {docker.py:413} INFO - found org.xerial.snappy#snappy-java;1.1.10.3 in central
[2025-02-21T13:38:04.029+0000] {docker.py:413} INFO - found org.slf4j#slf4j-api;2.0.7 in central
[2025-02-21T13:38:06.433+0000] {docker.py:413} INFO - found org.apache.hadoop#hadoop-client-runtime;3.3.4 in central
[2025-02-21T13:38:07.188+0000] {docker.py:413} INFO - found org.apache.hadoop#hadoop-client-api;3.3.4 in central
[2025-02-21T13:38:09.166+0000] {docker.py:413} INFO - found commons-logging#commons-logging;1.1.3 in central
[2025-02-21T13:38:10.199+0000] {docker.py:413} INFO - found com.google.code.findbugs#jsr305;3.0.0 in central
[2025-02-21T13:38:13.455+0000] {docker.py:413} INFO - found org.apache.commons#commons-pool2;2.11.1 in central
[2025-02-21T13:38:13.605+0000] {docker.py:413} INFO - downloading https://repo1.maven.org/maven2/org/postgresql/postgresql/42.5.4/postgresql-42.5.4.jar ...
[2025-02-21T13:38:13.954+0000] {docker.py:413} INFO - [SUCCESSFUL ] org.postgresql#postgresql;42.5.4!postgresql.jar (408ms)
[2025-02-21T13:38:14.024+0000] {docker.py:413} INFO - downloading https://repo1.maven.org/maven2/org/apache/spark/spark-sql-kafka-0-10_2.12/3.5.0/spark-sql-kafka-0-10_2.12-3.5.0.jar ...
[2025-02-21T13:38:14.287+0000] {docker.py:413} INFO - [SUCCESSFUL ] org.apache.spark#spark-sql-kafka-0-10_2.12;3.5.0!spark-sql-kafka-0-10_2.12.jar (325ms)
[2025-02-21T13:38:14.352+0000] {docker.py:413} INFO - downloading https://repo1.maven.org/maven2/org/checkerframework/checker-qual/3.5.0/checker-qual-3.5.0.jar ...
[2025-02-21T13:38:14.479+0000] {docker.py:413} INFO - [SUCCESSFUL ] org.checkerframework#checker-qual;3.5.0!checker-qual.jar (188ms)
[2025-02-21T13:38:14.541+0000] {docker.py:413} INFO - downloading https://repo1.maven.org/maven2/org/apache/spark/spark-token-provider-kafka-0-10_2.12/3.5.0/spark-token-provider-kafka-0-10_2.12-3.5.0.jar ...
[2025-02-21T13:38:14.613+0000] {docker.py:413} INFO - [SUCCESSFUL ] org.apache.spark#spark-token-provider-kafka-0-10_2.12;3.5.0!spark-token-provider-kafka-0-10_2.12.jar (123ms)
[2025-02-21T13:38:14.668+0000] {docker.py:413} INFO - downloading https://repo1.maven.org/maven2/org/apache/kafka/kafka-clients/3.4.1/kafka-clients-3.4.1.jar ...
[2025-02-21T13:38:17.221+0000] {docker.py:413} INFO - [SUCCESSFUL ] org.apache.kafka#kafka-clients;3.4.1!kafka-clients.jar (2599ms)
[2025-02-21T13:38:17.279+0000] {docker.py:413} INFO - downloading https://repo1.maven.org/maven2/com/google/code/findbugs/jsr305/3.0.0/jsr305-3.0.0.jar ...
[2025-02-21T13:38:17.370+0000] {docker.py:413} INFO - [SUCCESSFUL ] com.google.code.findbugs#jsr305;3.0.0!jsr305.jar (153ms)
[2025-02-21T13:38:17.423+0000] {docker.py:413} INFO - downloading https://repo1.maven.org/maven2/org/apache/commons/commons-pool2/2.11.1/commons-pool2-2.11.1.jar ...
[2025-02-21T13:38:17.642+0000] {docker.py:413} INFO - [SUCCESSFUL ] org.apache.commons#commons-pool2;2.11.1!commons-pool2.jar (269ms)
[2025-02-21T13:38:17.716+0000] {docker.py:413} INFO - downloading https://repo1.maven.org/maven2/org/apache/hadoop/hadoop-client-runtime/3.3.4/hadoop-client-runtime-3.3.4.jar ...
[2025-02-21T13:38:27.553+0000] {docker.py:413} INFO - [SUCCESSFUL ] org.apache.hadoop#hadoop-client-runtime;3.3.4!hadoop-client-runtime.jar (9902ms)
[2025-02-21T13:38:27.663+0000] {docker.py:413} INFO - downloading https://repo1.maven.org/maven2/org/lz4/lz4-java/1.8.0/lz4-java-1.8.0.jar ...
[2025-02-21T13:38:28.895+0000] {docker.py:413} INFO - [SUCCESSFUL ] org.lz4#lz4-java;1.8.0!lz4-java.jar (1329ms)
[2025-02-21T13:38:29.014+0000] {docker.py:413} INFO - downloading https://repo1.maven.org/maven2/org/xerial/snappy/snappy-java/1.1.10.3/snappy-java-1.1.10.3.jar ...
[2025-02-21T13:38:31.144+0000] {docker.py:413} INFO - [SUCCESSFUL ] org.xerial.snappy#snappy-java;1.1.10.3!snappy-java.jar(bundle) (2251ms)
[2025-02-21T13:38:31.214+0000] {docker.py:413} INFO - downloading https://repo1.maven.org/maven2/org/slf4j/slf4j-api/2.0.7/slf4j-api-2.0.7.jar ...
[2025-02-21T13:38:31.301+0000] {docker.py:413} INFO - [SUCCESSFUL ] org.slf4j#slf4j-api;2.0.7!slf4j-api.jar (150ms)
[2025-02-21T13:38:31.365+0000] {docker.py:413} INFO - downloading https://repo1.maven.org/maven2/org/apache/hadoop/hadoop-client-api/3.3.4/hadoop-client-api-3.3.4.jar ...
[2025-02-21T13:38:43.004+0000] {docker.py:413} INFO - [SUCCESSFUL ] org.apache.hadoop#hadoop-client-api;3.3.4!hadoop-client-api.jar (11699ms)
[2025-02-21T13:38:43.065+0000] {docker.py:413} INFO - downloading https://repo1.maven.org/maven2/commons-logging/commons-logging/1.1.3/commons-logging-1.1.3.jar ...
[2025-02-21T13:38:43.152+0000] {docker.py:413} INFO - [SUCCESSFUL ] commons-logging#commons-logging;1.1.3!commons-logging.jar (137ms)
[2025-02-21T13:38:43.157+0000] {docker.py:413} INFO - :: resolution report :: resolve 20645ms :: artifacts dl 29614ms
[2025-02-21T13:38:43.166+0000] {docker.py:413} INFO - :: modules in use:
[2025-02-21T13:38:43.168+0000] {docker.py:413} INFO - com.google.code.findbugs#jsr305;3.0.0 from central in [default]
[2025-02-21T13:38:43.171+0000] {docker.py:413} INFO - commons-logging#commons-logging;1.1.3 from central in [default]
[2025-02-21T13:38:43.172+0000] {docker.py:413} INFO - org.apache.commons#commons-pool2;2.11.1 from central in [default]
[2025-02-21T13:38:43.178+0000] {docker.py:413} INFO - org.apache.hadoop#hadoop-client-api;3.3.4 from central in [default]
	org.apache.hadoop#hadoop-client-runtime;3.3.4 from central in [default]
	org.apache.kafka#kafka-clients;3.4.1 from central in [default]
	org.apache.spark#spark-sql-kafka-0-10_2.12;3.5.0 from central in [default]
	org.apache.spark#spark-token-provider-kafka-0-10_2.12;3.5.0 from central in [default]
	org.checkerframework#checker-qual;3.5.0 from central in [default]
	org.lz4#lz4-java;1.8.0 from central in [default]
	org.postgresql#postgresql;42.5.4 from central in [default]
	org.slf4j#slf4j-api;2.0.7 from central in [default]
	org.xerial.snappy#snappy-java;1.1.10.3 from central in [default]
	---------------------------------------------------------------------
	|                  |            modules            ||   artifacts   |
	|       conf       | number| search|dwnlded|evicted|| number|dwnlded|
	---------------------------------------------------------------------
	|      default     |   13  |   13  |   13  |   0   ||   13  |   13  |
	---------------------------------------------------------------------
[2025-02-21T13:38:43.217+0000] {docker.py:413} INFO - :: retrieving :: org.apache.spark#spark-submit-parent-d706cd6e-0aec-4883-8377-41724e3539c2
[2025-02-21T13:38:43.221+0000] {docker.py:413} INFO - confs: [default]
[2025-02-21T13:38:43.710+0000] {docker.py:413} INFO - 13 artifacts copied, 0 already retrieved (58001kB/487ms)
[2025-02-21T13:38:45.874+0000] {docker.py:413} INFO - 25/02/21 13:38:45 WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
[2025-02-21T13:38:49.471+0000] {docker.py:413} INFO - python3: can't open file '/opt/bitnami/spark/scripts/spark_pgsql.py': [Errno 2] No such file or directory
[2025-02-21T13:38:49.552+0000] {docker.py:413} INFO - 25/02/21 13:38:49 INFO ShutdownHookManager: Shutdown hook called
[2025-02-21T13:38:49.557+0000] {docker.py:413} INFO - 25/02/21 13:38:49 INFO ShutdownHookManager: Deleting directory /tmp/spark-a8594eb6-cd3c-4292-ab5e-7e5d396f2112
[2025-02-21T13:38:50.408+0000] {taskinstance.py:1937} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/providers/docker/operators/docker.py", line 486, in execute
    return self._run_image()
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/providers/docker/operators/docker.py", line 360, in _run_image
    return self._run_image_with_mounts(self.mounts, add_tmp_variable=False)
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/providers/docker/operators/docker.py", line 421, in _run_image_with_mounts
    raise DockerContainerFailedException(f"Docker container failed: {result!r}", logs=log_lines)
airflow.providers.docker.exceptions.DockerContainerFailedException: Docker container failed: {'StatusCode': 2}
[2025-02-21T13:38:50.417+0000] {taskinstance.py:1400} INFO - Marking task as UP_FOR_RETRY. dag_id=kafka_spark_dag, task_id=pyspark_consumer, execution_date=20250220T133618, start_date=20250221T133714, end_date=20250221T133850
[2025-02-21T13:38:50.449+0000] {standard_task_runner.py:104} ERROR - Failed to execute job 34 for task pyspark_consumer (Docker container failed: {'StatusCode': 2}; 717)
[2025-02-21T13:38:50.499+0000] {local_task_job_runner.py:228} INFO - Task exited with return code 1
[2025-02-21T13:38:50.551+0000] {taskinstance.py:2778} INFO - 0 downstream tasks scheduled from follow-on schedule check
